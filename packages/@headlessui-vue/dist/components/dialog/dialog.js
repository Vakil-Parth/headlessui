import{computed as c,defineComponent as b,h as D,inject as K,nextTick as ee,onMounted as I,onUnmounted as te,provide as le,ref as h,watchEffect as N}from"vue";import{render as P,Features as V}from'../../utils/render.js';import{Keys as oe}from'../../keyboard.js';import{useId as w}from'../../hooks/use-id.js';import{FocusTrap as C}from'../../components/focus-trap/focus-trap.js';import{useInertOthers as ae}from'../../hooks/use-inert-others.js';import{Portal as Y,PortalGroup as re}from'../portal/portal.js';import{StackMessage as _,useStackProvider as ie}from'../../internal/stack-context.js';import{match as M}from'../../utils/match.js';import{ForcePortalRoot as F}from'../../internal/portal-force-root.js';import{Description as ne,useDescriptions as ue}from'../description/description.js';import{dom as U}from'../../utils/dom.js';import{useOpenClosed as se,State as q}from'../../internal/open-closed.js';import{useOutsideClick as pe}from'../../hooks/use-outside-click.js';import{getOwnerDocument as de}from'../../utils/owner.js';import{useEventListener as fe}from'../../hooks/use-event-listener.js';import{Hidden as ce,Features as ge}from'../../internal/hidden.js';import{disposables as me}from'../../utils/disposables.js';import{isIOS as ve}from'../../utils/platform.js';var De=(l=>(l[l.Open=0]="Open",l[l.Closed=1]="Closed",l))(De||{});let $=Symbol("DialogContext");function R(t){let u=K($,null);if(u===null){let l=new Error(`<${t} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,R),l}return u}let k="DC8F892D-2EBD-447C-A4C8-A03058436FF4",Ne=b({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:k},initialFocus:{type:Object,default:null},closeOnEsc:{type:Boolean,default:!0},closeOnOutsideClick:{type:Boolean,default:!0}},emits:{close:t=>!0},setup(t,{emit:u,attrs:l,slots:s,expose:i}){var A;let g=h(!1);I(()=>{g.value=!0});let r=h(0),d=se(),O=c(()=>t.open===k&&d!==null?M(d.value,{[q.Open]:!0,[q.Closed]:!1}):t.open),x=h(new Set),m=h(null),j=h(null),B=c(()=>de(m));if(i({el:m,$el:m}),!(t.open!==k||d!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof O.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${O.value===k?void 0:t.open}`);let f=c(()=>g.value&&O.value?0:1),H=c(()=>f.value===0),T=c(()=>r.value>1),G=K($,null)!==null,z=c(()=>T.value?"parent":"leaf");ae(m,c(()=>T.value?H.value:!1)),ie({type:"Dialog",enabled:c(()=>f.value===0),element:m,onUpdate:(a,o,n)=>{if(o==="Dialog")return M(a,{[_.Add](){x.value.add(n),r.value+=1},[_.Remove](){x.value.delete(n),r.value-=1}})}});let J=ue({name:"DialogDescription",slot:c(()=>({open:O.value}))}),Q=`headlessui-dialog-${w()}`,E=h(null),S={titleId:E,panelRef:h(null),dialogState:f,setTitleId(a){E.value!==a&&(E.value=a)},close(){u("close",!1)}};return le($,S),pe(()=>{var o,n,p;return[...Array.from((n=(o=B.value)==null?void 0:o.querySelectorAll("body > *, [data-headlessui-portal]"))!=null?n:[]).filter(e=>!(!(e instanceof HTMLElement)||e.contains(U(j))||S.panelRef.value&&e.contains(S.panelRef.value))),(p=S.panelRef.value)!=null?p:m.value]},(a,o)=>{S.close(),ee(()=>o==null?void 0:o.focus())},c(()=>f.value===0&&!T.value&&t.closeOnOutsideClick)),fe((A=B.value)==null?void 0:A.defaultView,"keydown",a=>{!t.closeOnEsc||a.defaultPrevented||a.key===oe.Escape&&f.value===0&&(T.value||(a.preventDefault(),a.stopPropagation(),S.close()))}),N(a=>{var W;if(f.value!==0||G)return;let o=B.value;if(!o)return;let n=me();function p(v,y,X){let Z=v.style.getPropertyValue(y);return Object.assign(v.style,{[y]:X}),n.add(()=>{Object.assign(v.style,{[y]:Z})})}let e=o==null?void 0:o.documentElement,L=((W=o.defaultView)!=null?W:window).innerWidth-e.clientWidth;if(p(e,"overflow","hidden"),L>0){let v=e.clientWidth-e.offsetWidth,y=L-v;p(e,"paddingRight",`${y}px`)}if(ve()){let v=window.pageYOffset;p(e,"position","fixed"),p(e,"marginTop",`-${v}px`),p(e,"width","100%"),n.add(()=>window.scrollTo(0,v))}a(n.dispose)}),N(a=>{if(f.value!==0)return;let o=U(m);if(!o)return;let n=new IntersectionObserver(p=>{for(let e of p)e.boundingClientRect.x===0&&e.boundingClientRect.y===0&&e.boundingClientRect.width===0&&e.boundingClientRect.height===0&&S.close()});n.observe(o),a(()=>n.disconnect())}),()=>{let a={...l,ref:m,id:Q,role:"dialog","aria-modal":f.value===0?!0:void 0,"aria-labelledby":E.value,"aria-describedby":J.value},{open:o,initialFocus:n,...p}=t,e={open:f.value===0};return D(F,{force:!0},()=>[D(Y,()=>D(re,{target:m.value},()=>D(F,{force:!1},()=>D(C,{initialFocus:n,containers:x,features:H.value?M(z.value,{parent:C.features.RestoreFocus,leaf:C.features.All&~C.features.FocusLock}):C.features.None},()=>P({ourProps:a,theirProps:p,slot:e,attrs:l,slots:s,visible:f.value===0,features:V.RenderStrategy|V.Static,name:"Dialog"}))))),D(ce,{features:ge.Hidden,ref:j})])}}}),Ve=b({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"}},setup(t,{attrs:u,slots:l}){let s=R("DialogOverlay"),i=`headlessui-dialog-overlay-${w()}`;function g(r){r.target===r.currentTarget&&(r.preventDefault(),r.stopPropagation(),s.close())}return()=>P({ourProps:{id:i,"aria-hidden":!0,onClick:g},theirProps:t,slot:{open:s.dialogState.value===0},attrs:u,slots:l,name:"DialogOverlay"})}}),Ye=b({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"}},inheritAttrs:!1,setup(t,{attrs:u,slots:l,expose:s}){let i=R("DialogBackdrop"),g=`headlessui-dialog-backdrop-${w()}`,r=h(null);return s({el:r,$el:r}),I(()=>{if(i.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let d=t,O={id:g,ref:r,"aria-hidden":!0};return D(F,{force:!0},()=>D(Y,()=>P({ourProps:O,theirProps:{...u,...d},slot:{open:i.dialogState.value===0},attrs:u,slots:l,name:"DialogBackdrop"})))}}}),_e=b({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"}},setup(t,{attrs:u,slots:l,expose:s}){let i=R("DialogPanel"),g=`headlessui-dialog-panel-${w()}`;s({el:i.panelRef,$el:i.panelRef});function r(d){d.stopPropagation()}return()=>{let d={id:g,ref:i.panelRef,onClick:r};return P({ourProps:d,theirProps:t,slot:{open:i.dialogState.value===0},attrs:u,slots:l,name:"DialogPanel"})}}}),Ue=b({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"}},setup(t,{attrs:u,slots:l}){let s=R("DialogTitle"),i=`headlessui-dialog-title-${w()}`;return I(()=>{s.setTitleId(i),te(()=>s.setTitleId(null))}),()=>P({ourProps:{id:i},theirProps:t,slot:{open:s.dialogState.value===0},attrs:u,slots:l,name:"DialogTitle"})}}),qe=ne;export{Ne as Dialog,Ye as DialogBackdrop,qe as DialogDescription,Ve as DialogOverlay,_e as DialogPanel,Ue as DialogTitle};
