import{Fragment as ne,createContext as W,useContext as N,useMemo as I,useReducer as ae,useRef as U}from"react";import{render as v,Features as Y,forwardRefWithAs as C}from'../../utils/render.js';import{useId as Z}from'../../hooks/use-id.js';import{match as ee}from'../../utils/match.js';import{Keys as m}from'../../components/keyboard.js';import{focusIn as h,Focus as P,sortByDomNode as te,FocusResult as w}from'../../utils/focus-management.js';import{useIsoMorphicEffect as B}from'../../hooks/use-iso-morphic-effect.js';import{useSyncRefs as F}from'../../hooks/use-sync-refs.js';import{useResolveButtonType as le}from'../../hooks/use-resolve-button-type.js';import{useLatestValue as K}from'../../hooks/use-latest-value.js';import{FocusSentinel as Te}from'../../internal/focus-sentinel.js';import{useEvent as H}from'../../hooks/use-event.js';import{microTask as me}from'../../utils/micro-task.js';import{Hidden as Pe}from'../../internal/hidden.js';import{getOwnerDocument as xe}from'../../utils/owner.js';var ge=(n=>(n[n.SetSelectedIndex=0]="SetSelectedIndex",n[n.RegisterTab=1]="RegisterTab",n[n.UnregisterTab=2]="UnregisterTab",n[n.RegisterPanel=3]="RegisterPanel",n[n.UnregisterPanel=4]="UnregisterPanel",n))(ge||{});let Re={[0](e,t){let r=e.tabs.filter(i=>{var l;return!((l=i.current)!=null&&l.hasAttribute("disabled"))});if(t.index<0)return{...e,selectedIndex:e.tabs.indexOf(r[0])};if(t.index>e.tabs.length)return{...e,selectedIndex:e.tabs.indexOf(r[r.length-1])};let o=e.tabs.slice(0,t.index),n=[...e.tabs.slice(t.index),...o].find(i=>r.includes(i));return n?{...e,selectedIndex:e.tabs.indexOf(n)}:e},[1](e,t){var n;if(e.tabs.includes(t.tab))return e;let r=e.tabs[e.selectedIndex],o=te([...e.tabs,t.tab],i=>i.current),s=(n=o.indexOf(r))!=null?n:e.selectedIndex;return s===-1&&(s=e.selectedIndex),{...e,tabs:o,selectedIndex:s}},[2](e,t){return{...e,tabs:e.tabs.filter(r=>r!==t.tab)}},[3](e,t){return e.panels.includes(t.panel)?e:{...e,panels:te([...e.panels,t.panel],r=>r.current)}},[4](e,t){return{...e,panels:e.panels.filter(r=>r!==t.panel)}}},$=W(null);$.displayName="TabsSSRContext";function z(e){let t=N($);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,z),r}return t}let V=W(null);V.displayName="TabsDataContext";function D(e){let t=N(V);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,D),r}return t}let q=W(null);q.displayName="TabsActionsContext";function J(e){let t=N(q);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,J),r}return t}function ye(e,t){return ee(t.type,Re,e,t)}let Ae=ne,Ee=C(function(t,r){let{defaultIndex:o=0,vertical:s=!1,manual:n=!1,onChange:i,selectedIndex:l=null,...R}=t;const p=s?"vertical":"horizontal",S=n?"manual":"auto";let b=l!==null,u=F(r),[c,f]=ae(ye,{selectedIndex:l!=null?l:o,tabs:[],panels:[]}),T=I(()=>({selectedIndex:c.selectedIndex}),[c.selectedIndex]),x=K(i||(()=>{})),y=K(c.tabs),E=I(()=>({orientation:p,activation:S,...c}),[p,S,c]),A=K(b?t.selectedIndex:c.selectedIndex),L=I(()=>({registerTab(d){return f({type:1,tab:d}),()=>f({type:2,tab:d})},registerPanel(d){return f({type:3,panel:d}),()=>f({type:4,panel:d})},change(d){A.current!==d&&x.current(d),b||f({type:0,index:d})}}),[f,b]);B(()=>{f({type:0,index:l!=null?l:o})},[l]);let O=U({tabs:[],panels:[]}),k={ref:u};return<$.Provider value={O}><q.Provider value={L}><V.Provider value={E}>{E.tabs.length<=0&&<Te onFocus={()=>{var d,_;for(let M of y.current)if(((d=M.current)==null?void 0:d.tabIndex)===0)return(_=M.current)==null||_.focus(),!0;return!1}}/>}{v({ourProps:k,theirProps:R,slot:T,defaultTag:Ae,name:"Tabs"})}</V.Provider></q.Provider></$.Provider>}),Se="div",Le=C(function(t,r){let{orientation:o,selectedIndex:s}=D("Tab.List"),n=F(r);return v({ourProps:{ref:n,role:"tablist","aria-orientation":o},theirProps:t,slot:{selectedIndex:s},defaultTag:Se,name:"Tabs.List"})}),Ie="button",he=C(function(t,r){var M,Q;let o=`headlessui-tabs-tab-${Z()}`,{orientation:s,activation:n,selectedIndex:i,tabs:l,panels:R}=D("Tab"),p=J("Tab"),S=D("Tab"),b=z("Tab"),u=U(null),c=F(u,r);B(()=>p.registerTab(u),[p,u]);let f=b.current.tabs.indexOf(o);f===-1&&(f=b.current.tabs.push(o)-1);let T=l.indexOf(u);T===-1&&(T=f);let x=T===i,y=H(a=>{var G;let g=a();if(g===w.Success&&n==="auto"){let j=(G=xe(u))==null?void 0:G.activeElement,X=S.tabs.findIndex(re=>re.current===j);X!==-1&&p.change(X)}return g}),E=H(a=>{let g=l.map(j=>j.current).filter(Boolean);if(a.key===m.Space||a.key===m.Enter){a.preventDefault(),a.stopPropagation(),p.change(T);return}switch(a.key){case m.Home:case m.PageUp:return a.preventDefault(),a.stopPropagation(),y(()=>h(g,P.First));case m.End:case m.PageDown:return a.preventDefault(),a.stopPropagation(),y(()=>h(g,P.Last))}if(y(()=>ee(s,{vertical(){return a.key===m.ArrowUp?h(g,P.Previous|P.WrapAround):a.key===m.ArrowDown?h(g,P.Next|P.WrapAround):w.Error},horizontal(){return a.key===m.ArrowLeft?h(g,P.Previous|P.WrapAround):a.key===m.ArrowRight?h(g,P.Next|P.WrapAround):w.Error}}))===w.Success)return a.preventDefault()}),A=U(!1),L=H(()=>{var a;A.current||(A.current=!0,(a=u.current)==null||a.focus(),p.change(T),me(()=>{A.current=!1}))}),O=H(a=>{a.preventDefault()}),k=I(()=>({selected:x}),[x]),d=t,_={ref:c,onKeyDown:E,onMouseDown:O,onClick:L,id:o,role:"tab",type:le(t,u),"aria-controls":(Q=(M=R[T])==null?void 0:M.current)==null?void 0:Q.id,"aria-selected":x,tabIndex:x?0:-1};return v({ourProps:_,theirProps:d,slot:k,defaultTag:Ie,name:"Tabs.Tab"})}),De="div",Me=C(function(t,r){let{selectedIndex:o}=D("Tab.Panels"),s=F(r),n=I(()=>({selectedIndex:o}),[o]);return v({ourProps:{ref:s},theirProps:t,slot:n,defaultTag:De,name:"Tabs.Panels"})}),ve="div",Ce=Y.RenderStrategy|Y.Static,Fe=C(function(t,r){var y,E,A,L;let{selectedIndex:o,tabs:s,panels:n}=D("Tab.Panel"),i=J("Tab.Panel"),l=z("Tab.Panel"),R=`headlessui-tabs-panel-${Z()}`,p=U(null),S=F(p,r);B(()=>i.registerPanel(p),[i,p]);let b=l.current.panels.indexOf(R);b===-1&&(b=l.current.panels.push(R)-1);let u=n.indexOf(p);u===-1&&(u=b);let c=u===o,f=I(()=>({selected:c}),[c]),T=t,x={ref:S,id:R,role:"tabpanel","aria-labelledby":(E=(y=s[u])==null?void 0:y.current)==null?void 0:E.id,tabIndex:c?0:-1};return!c&&((A=t.unmount)!=null?A:!0)&&!((L=t.static)!=null&&L)?<Pe as="span"{...x}/>:v({ourProps:x,theirProps:T,slot:f,defaultTag:ve,features:Ce,visible:c,name:"Tabs.Panel"})}),nt=Object.assign(he,{Group:Ee,List:Le,Panels:Me,Panel:Fe});export{nt as Tab};
