import{createContext as Re,createRef as ye,useContext as N,useEffect as w,useMemo as y,useReducer as he,useRef as H,useState as be}from"react";import{match as F}from'../../utils/match.js';import{forwardRefWithAs as b,render as E,Features as V}from'../../utils/render.js';import{useSyncRefs as A}from'../../hooks/use-sync-refs.js';import{Keys as Ee}from'../keyboard.js';import{isDisabledReactIssue7711 as Ae}from'../../utils/bugs.js';import{useId as O}from'../../hooks/use-id.js';import{FocusTrap as C}from'../../components/focus-trap/focus-trap.js';import{useInertOthers as Oe}from'../../hooks/use-inert-others.js';import{Portal as W}from'../../components/portal/portal.js';import{ForcePortalRoot as B}from'../../internal/portal-force-root.js';import{Description as ve,useDescriptions as Ce}from'../description/description.js';import{useOpenClosed as Se,State as K}from'../../internal/open-closed.js';import{useServerHandoffComplete as Le}from'../../hooks/use-server-handoff-complete.js';import{StackProvider as Fe,StackMessage as q}from'../../internal/stack-context.js';import{useOutsideClick as Me}from'../../hooks/use-outside-click.js';import{useOwnerDocument as _e}from'../../hooks/use-owner.js';import{useEventListener as xe}from'../../hooks/use-event-listener.js';import{Hidden as Ie,Features as He}from'../../internal/hidden.js';import{useEvent as S}from'../../hooks/use-event.js';import{disposables as We}from'../../utils/disposables.js';import{isIOS as Be}from'../../utils/platform.js';var Ge=(r=>(r[r.Open=0]="Open",r[r.Closed=1]="Closed",r))(Ge||{}),Ue=(e=>(e[e.SetTitleId=0]="SetTitleId",e))(Ue||{});let $e={[0](l,e){return l.titleId===e.id?l:{...l,titleId:e.id}}},M=Re(null);M.displayName="DialogContext";function L(l){let e=N(M);if(e===null){let r=new Error(`<${l} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,L),r}return e}function Ye(l,e){w(()=>{var d;if(!e||!l)return;let r=We();function t(n,p,h){let i=n.style.getPropertyValue(p);return Object.assign(n.style,{[p]:h}),r.add(()=>{Object.assign(n.style,{[p]:i})})}let o=l.documentElement,s=((d=l.defaultView)!=null?d:window).innerWidth-o.clientWidth;if(t(o,"overflow","hidden"),s>0){let n=o.clientWidth-o.offsetWidth,p=s-n;t(o,"paddingRight",`${p}px`)}if(Be()){let n=window.pageYOffset;t(o,"position","fixed"),t(o,"marginTop",`-${n}px`),t(o,"width","100%"),r.add(()=>window.scrollTo(0,n))}return r.dispose},[l,e])}function je(l,e){return F(e.type,$e,l,e)}let Ne="div",Ve=V.RenderStrategy|V.Static,Ke=b(function(e,r){let{open:t,onClose:o,initialFocus:a,__demoMode:s=!1,closeOnEsc:d=!0,closeOnOutsideClick:n=!0,...p}=e,[h,i]=be(0),_=Se();t===void 0&&_!==null&&(t=F(_,{[K.Open]:!0,[K.Closed]:!1}));let x=H(new Set),g=H(null),z=A(g,r),G=H(null),T=_e(g),U=e.hasOwnProperty("open")||_!==null,$=e.hasOwnProperty("onClose");if(!U&&!$)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!U)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!$)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(typeof t!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${t}`);if(typeof o!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${o}`);let u=t?0:1,[P,J]=he(je,{titleId:null,descriptionId:null,panelRef:ye()}),D=S(()=>o(!1)),Y=S(f=>J({type:0,id:f})),I=Le()?s?!1:u===0:!1,k=h>1,Q=N(M)!==null,X=k?"parent":"leaf";Oe(g,k?I:!1),Me(()=>{var R,c;return[...Array.from((R=T==null?void 0:T.querySelectorAll("body > *, [data-headlessui-portal]"))!=null?R:[]).filter(m=>!(!(m instanceof HTMLElement)||m.contains(G.current)||P.panelRef.current&&m.contains(P.panelRef.current))),(c=P.panelRef.current)!=null?c:g.current]},D,I&&!k&&n),xe(T==null?void 0:T.defaultView,"keydown",f=>{!d||f.defaultPrevented||f.key===Ee.Escape&&u===0&&(k||(f.preventDefault(),f.stopPropagation(),D()))}),Ye(T,u===0&&!Q),w(()=>{if(u!==0||!g.current)return;let f=new IntersectionObserver(R=>{for(let c of R)c.boundingClientRect.x===0&&c.boundingClientRect.y===0&&c.boundingClientRect.width===0&&c.boundingClientRect.height===0&&D()});return f.observe(g.current),()=>f.disconnect()},[u,g,D]);let[Z,Te]=Ce(),me=`headlessui-dialog-${O()}`,Pe=y(()=>[{dialogState:u,close:D,setTitleId:Y},P],[u,P,D,Y]),j=y(()=>({open:u===0}),[u]),De={ref:z,id:me,role:"dialog","aria-modal":u===0?!0:void 0,"aria-labelledby":P.titleId,"aria-describedby":Z};return<Fe type="Dialog"enabled={u===0}element={g}onUpdate={S((f,R,c)=>{R==="Dialog"&&F(f,{[q.Add](){x.current.add(c),i(m=>m+1)},[q.Remove](){x.current.add(c),i(m=>m-1)}})})}><B force={!0}><W><M.Provider value={Pe}><W.Group target={g}><B force={!1}><Te slot={j}name="Dialog.Description"><C initialFocus={a}containers={x}features={I?F(X,{parent:C.features.RestoreFocus,leaf:C.features.All&~C.features.FocusLock}):C.features.None}>{E({ourProps:De,theirProps:p,slot:j,defaultTag:Ne,features:Ve,visible:u===0,name:"Dialog"})}</C></Te></B></W.Group></M.Provider></W></B><Ie features={He.Hidden}ref={G}/></Fe>}),qe="div",ze=b(function(e,r){let[{dialogState:t,close:o}]=L("Dialog.Overlay"),a=A(r),s=`headlessui-dialog-overlay-${O()}`,d=S(i=>{if(i.target===i.currentTarget){if(Ae(i.currentTarget))return i.preventDefault();i.preventDefault(),i.stopPropagation(),o()}}),n=y(()=>({open:t===0}),[t]);return E({ourProps:{ref:a,id:s,"aria-hidden":!0,onClick:d},theirProps:e,slot:n,defaultTag:qe,name:"Dialog.Overlay"})}),Je="div",Qe=b(function(e,r){let[{dialogState:t},o]=L("Dialog.Backdrop"),a=A(r),s=`headlessui-dialog-backdrop-${O()}`;w(()=>{if(o.panelRef.current===null)throw new Error("A <Dialog.Backdrop /> component is being used, but a <Dialog.Panel /> component is missing.")},[o.panelRef]);let d=y(()=>({open:t===0}),[t]),n=e,p={ref:a,id:s,"aria-hidden":!0};return<B force><W>{E({ourProps:p,theirProps:n,slot:d,defaultTag:Je,name:"Dialog.Backdrop"})}</W></B>}),Xe="div",Ze=b(function(e,r){let[{dialogState:t},o]=L("Dialog.Panel"),a=A(r,o.panelRef),s=`headlessui-dialog-panel-${O()}`,d=y(()=>({open:t===0}),[t]),n=S(i=>{i.stopPropagation()});return E({ourProps:{ref:a,id:s,onClick:n},theirProps:e,slot:d,defaultTag:Xe,name:"Dialog.Panel"})}),et="h2",tt=b(function(e,r){let[{dialogState:t,setTitleId:o}]=L("Dialog.Title"),a=`headlessui-dialog-title-${O()}`,s=A(r);w(()=>(o(a),()=>o(null)),[a,o]);let d=y(()=>({open:t===0}),[t]);return E({ourProps:{ref:s,id:a},theirProps:e,slot:d,defaultTag:et,name:"Dialog.Title"})}),_t=Object.assign(Ke,{Backdrop:Qe,Panel:Ze,Overlay:ze,Title:tt,Description:ve});export{_t as Dialog};
