import{Fragment as s,createContext as h,useContext as L,useEffect as m,useRef as d,useState as T}from"react";import{createPortal as y}from"react-dom";import{forwardRefWithAs as P,render as R}from'../../utils/render.js';import{useIsoMorphicEffect as G}from'../../hooks/use-iso-morphic-effect.js';import{usePortalRoot as M}from'../../internal/portal-force-root.js';import{useServerHandoffComplete as v}from'../../hooks/use-server-handoff-complete.js';import{optionalRef as C,useSyncRefs as c}from'../../hooks/use-sync-refs.js';import{useOwnerDocument as g}from'../../hooks/use-owner.js';import{microTask as O}from'../../utils/micro-task.js';import{isServer as E}from'../../utils/ssr.js';function H(i){let u=M(),o=L(A),e=g(i),[r,f]=T(()=>{if(!u&&o!==null||E)return null;let n=e==null?void 0:e.getElementById("headlessui-portal-root");if(n)return n;if(e===null)return null;let t=e.createElement("div");return t.setAttribute("id","headlessui-portal-root"),e.body.appendChild(t)});return m(()=>{r!==null&&(e!=null&&e.body.contains(r)||e==null||e.body.appendChild(r))},[r,e]),m(()=>{u||o!==null&&f(o.current)},[o,f,u]),r}let x=s,_=P(function(u,o){let e=u,r=d(null),f=c(C(a=>{r.current=a}),o),n=g(r),t=H(r),[l]=T(()=>{var a;return E?null:(a=n==null?void 0:n.createElement("div"))!=null?a:null}),b=v(),p=d(!1);return G(()=>{if(p.current=!1,!(!t||!l))return t.contains(l)||(l.setAttribute("data-headlessui-portal",""),t.appendChild(l)),()=>{p.current=!0,O(()=>{var a;!p.current||!t||!l||(t.removeChild(l),t.childNodes.length<=0&&((a=t.parentElement)==null||a.removeChild(t)))})}},[t,l]),b?!t||!l?null:y(R({ourProps:{ref:f},theirProps:e,defaultTag:x,name:"Portal"}),l):null}),U=s,A=h(null),j=P(function(u,o){let{target:e,...r}=u,n={ref:c(o)};return<A.Provider value={e}>{R({ourProps:n,theirProps:r,defaultTag:U,name:"Popover.Group"})}</A.Provider>}),$=Object.assign(_,{Group:j});export{$ as Portal};
